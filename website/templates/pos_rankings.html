{% extends 'base.html' %}

{% block title %}
	Positional Rankings
{% endblock %}

{% block content %}
	<div class="jumbotron text-center" style="color:white; background-color:#1D2228;">
	   <div class=" mx-auto my-1">
	       <h1 class="display-4 font-weight-normal" style="color: white">Your Custom {% block h1 %} {% endblock %} Rankings</h1>
	   </div>
	</div>
	<div class="container">
		<div class="text-center row">
			<p style=""class="col">Filter By Position: <a href="{{ url_for('rankings_page') }}">All</a> | <a href="{{ url_for('qb_rankings_page') }}">QB</a> | <a href="{{ url_for('rb_rankings_page') }}">RB</a> | <a href="{{ url_for('wr_rankings_page') }}">WR</a> | <a href="{{ url_for('te_rankings_page') }}">TE</a> 
			</p>
		</div>
		<div class="row">
			<div class="col text-center">
				<button class="btn btn-outline-primary" data-toggle="modal" data-target="#Modal-AddTier-{{ max_tier }}">Add Tier</button>
			</div>
		</div>
		<div class="text-center">
			<form method="POST" class="save-changes">
				<a id="save-changes-btn" style="display: none" onclikc="save_changes" class="btn btn-outline-primary" href="{{ url_for('rankings_page') }}">Save Changes</a>
			</form>
		</div>
		<br>
		<table class="table table-hover table-striped table-dark" style="background-color: #1D2228">
			<thead>
				<tr>
					<th scope="col" class="text-center">Custom {% block p %} {% endblock %} Rank</th>
					<th scope="col" class="text-center">Name</th>
					<th scope="col" class="text-center">Team</th>
					<th scope="col" class="text-center">ADP</th>
					<th scope="col" class="text-center">Fantasy Pros</th>
					<th scope="col" class="text-center">FFB Calculator</th>
					<th scope="col" class="text-center">Sporting News</th>
					<th scope="col" class="text-center">Options</th>
				</tr>
			</thead>
			<tbody>
				{% set tiers = [] %}
				{% for player in players %}
				{% include 'includes/pos_player_modals.html' %}
					{% if tiers|length < 1 or player.custom_tier != tiers[-1] %}
						{% do tiers.append(player.custom_tier) %}
						<tr>
							<td class="bg-secondary">Tier {{ player.custom_tier }}  <a href="#">Edit Tier</a></td>
						</tr>
					{% endif %}
					<tr class="player-row" id="{{ player.id }}-row">
						<td class="text-center custom-rank" form="player-form">{{ player.custom_pos_rank }}</td>
						<td class="text-center">{{ player[0].name }}</td>
						<td class="text-center">{{ player[0].team }}</td>
						<td class="text-center">{{ player[0].adp }}</td>
						<td class="text-center">{{ player[0].fp_rank }}</td>
						<td class="text-center">{{ player[0].ffb_calc_rank }}</td>
						<td class="text-center">{{ player[0].sport_news_rank }}</td>
						<td class="text-center">
								<button class="btn btn-outline btn-outline-warning btn-sm" data-toggle="modal" data-target="#Modal-SwapPosRank-{{ player[0].id }}">Swap</button>
						</td>
					</tr>
				{% endfor %}
			</tbody>
		</table>
	</div>

	<script>

		// None of this script is currently being used to perform player swaps
		// It is an alternative to the method player modals method I am using
		addListeners();

		var selected_player1;
		var selected_player2;

		function addListeners() {
			swap_btns = document.getElementsByClassName('btn btn-outline btn-outline-success btn-sm');
			for (var i = 0; i < swap_btns.length; i++) {
				swap_btns[i].addEventListener("click", swap);
			}
		}
		
		function swap() {
			for (var i = 0; i < swap_btns.length; i++) {
				swap_btns[i].innerHTML = "Swap";
				swap_btns[i].removeEventListener("click", swap);
				swap_btns[i].addEventListener("click", swap_players);
				selected_player1 = this.id;
			}	
		}

		function swap_players() {
			for (var i = 0; i < swap_btns.length; i++) {
				swap_btns[i].innerHTML = "Change Ranking";
				swap_btns[i].removeEventListener("click", swap_players);
				swap_btns[i].addEventListener("click", swap);
				selected_player2 = this.id;
			}
			document.getElementById("save-changes-btn").style.display='inline';
			swap_rows();
		}

		function swap_rows() {
			var player1_row_id = selected_player1.substring(0, selected_player1.length-3) + "row";
			var player2_row_id = selected_player2.substring(0, selected_player2.length-3) + "row";
			var player1_row = document.getElementById(player1_row_id);
			var player2_row = document.getElementById(player2_row_id);
			var temp = player1_row.innerHTML;
			player1_row.innerHTML = player2_row.innerHTML;
			player2_row.innerHTML = temp;

			player1_row.id = player2_row_id;
			player2_row.id = player1_row_id;

			player1_rank = player1_row.getElementsByClassName("text-center custom-rank")[0];
			player2_rank = player2_row.getElementsByClassName("text-center custom-rank")[0];
			temp2 = player1_rank.innerHTML
			player1_rank.innerHTML = player2_rank.innerHTML
			player2_rank.innerHTML = temp2

			addListeners();
		}

	</script>
{% endblock %}




